
//判断是否已经引入js
function isInclude(name){
    var js= /js$/i.test(name);
    var es=document.getElementsByTagName(js?'script':'link');
    for(var i=0;i<es.length;i++)
        if(es[i][js?'src':'href'].indexOf(name)!=-1)return true;
    return false;
}

function isExistFile(url) {
    var xmlhttp;
    if(window.XMLHttpRequest) {
        xmlhttp = new XMLHttpRequest();//其他浏览器
    } else if (window.ActiveXObject)
    {
        try {
            xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");//旧版IE
        }
        catch (e) { }
        try {
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");//新版IE
        }
        catch (e) { }
        if (!xmlhttp) {
            window.alert("不能创建XMLHttpRequest对象");
        }
    }
    xmlhttp.open("GET",url,false);
    xmlhttp.send();
    if(xmlhttp.readyState === 4){
        if(xmlhttp.status === 200){
            //url存在
            // console.log(xmlhttp.responseText);
            return true;
        }else{
            return false;
            //alert("该文件不存在"); //url不存在
        }
    }else{
        return false;
    }
}
function loadExtJS(url) {
    var oHead = document.getElementsByTagName('HEAD').item(0);
    var oTitle = document.getElementsByTagName('title');
    var oScript = document.createElement("script");
    oScript.type = "text/javascript";
    oScript.src = url;
    oHead.appendChild(oScript);

    var fileName = url.substr(url.lastIndexOf("/") + 1);
    var t = window.setInterval(function() {
        if(isInclude(fileName)){
            window.clearInterval(t);
            loadExtFileQueue();
        }else{ }
    }, 50);
}
function loadExtCSS(url) {
    var oHead = document.getElementsByTagName('HEAD').item(0);
    var oScript = document.createElement("link");
    oScript.rel = "stylesheet";
    oScript.type = "text/css";
    oScript.href = url;

    var fileName = url.substr(url.lastIndexOf("/") + 1);
    var t = window.setInterval(function() {
        if(isInclude(fileName)){
            window.clearInterval(t);
            loadExtFileQueue();
        }else{ }
    }, 50);
}
function loadExtFile(url,url2,type) {
    var nowURL;
    var res = isExistFile(url);
    if (res === false) {
        // alert("请求的无效资源");
        nowURL = url2;
    } else {
        nowURL = url;
    }
    if(type === "js"){
        loadExtJS(nowURL);
    }else if(type === "css") {
        loadExtCSS(nowURL);
    }
}
var extFileIndex = 0;var extFileList = [];
function loadExtFileQueue() {
    if(extFileIndex < extFileList.length){
        loadExtFile(extFileList[extFileIndex].url,extFileList[extFileIndex].url2,extFileList[extFileIndex].type);
        extFileIndex ++;
    }
}

function setExtFileList(ary) {
    extFileList = ary;
}


//使用方法
// var extFileManifest = [
//     {url:"h5code/js/jquery.min.js",url2:"../h5code/js/jquery.min.js", type:"js"},
//     {url:"h5code/lib/IH5Slide.js",url2:"../h5code/lib/IH5Slide.js", type:"js"},
//     {url:"h5code/js/showMC.js",url2:"../h5code/js/showMC.js", type:"js"}
// ];
// setExtFileList(extFileManifest);
// loadExtFileQueue();